var dialogBox=document.createElement("div"),LargedialogBox=document.createElement("div"),RightBox=document.createElement("div"),LeftBox=document.createElement("div"),heading=document.createElement("div"),divider=document.createElement("div"),subHeading1=document.createElement("div"),subHeading2=document.createElement("div"),linkPreview=document.createElement("div"),linkDisplayImage=document.createElement("img"),linkDisplayTitle=document.createElement("div"),linkDisplay=document.createElement("div"),pageTitleHeading=document.createElement("div"),pageTitleInput=document.createElement("input"),pageDataBaseHeading=document.createElement("div"),saveScreenshotSnippetButton=document.createElement("div"),cancelButton=document.createElement("div"),backdrop=document.createElement("div"),AddToHeading=document.createElement("div"),AddTo=document.createElement("div"),backButton=document.createElement("div"),searchInput=document.createElement("input"),notionDataBox=document.createElement("div"),notionDbBox=document.createElement("div"),notionPagesBox=document.createElement("div"),notionDbBoxSearched=document.createElement("div"),notionPagesBoxSearched=document.createElement("div");function makingScreenshotSnippetModal(){LargedialogBox.id="prototionBigDialogBox",LeftBox.classList.add("notion-clipper-left"),LeftBox.classList.remove("notion-clipper-left-full-page-ss"),RightBox.classList.add("notion-clipper-right"),heading.classList.add("notion-clipper-heading"),divider.classList.add("notion-clipper-divider"),subHeading2.classList.add("notion-clipper-subHeading"),subHeading2.innerHTML="Title",pageTitleHeading.classList.add("notion-clipper-subHeading"),pageTitleHeading.innerHTML="Title",pageTitleInput.classList.add("notion-clipper-input-style"),AddToHeading.classList.add("notion-clipper-subHeading"),AddToHeading.innerText="Adding to",AddTo.classList.add("AddTo"),AddTo.innerHTML=`<span>${selectedDB.name}</span>`,AddTo.addEventListener("click",(()=>{RightBox.classList.add("search-active")})),backButton.addEventListener("click",(()=>{RightBox.classList.remove("search-active")})),searchInput.addEventListener("keyup",(e=>{0===e.target.value.length?(notionDbBox.classList.remove("hideComplete"),notionPagesBox.classList.remove("hideComplete"),notionDbBoxSearched.classList.add("hideComplete"),notionPagesBoxSearched.classList.add("hideComplete")):(notionDbBox.classList.add("hideComplete"),notionPagesBox.classList.add("hideComplete"),notionDbBoxSearched.classList.remove("hideComplete"),notionPagesBoxSearched.classList.remove("hideComplete"))}));const e=((e,t)=>{let n;return function(){const o=this,i=arguments;clearTimeout(n),n=setTimeout((()=>{e.apply(o,[i])}),t)}})((e=>{chrome.runtime.sendMessage({message:"get_pages",payload:{query:e[0].target.value}},(e=>{notionDbBoxSearched.innerHTML="",notionPagesBoxSearched.innerHTML="",e.forEach((e=>{if("collection_view"===e.record.type){var t=document.createElement("div"),n=(o=document.createElement("span")).cloneNode(!0);i=e.record.iconEmoji?e.record.iconEmoji:"✨",t.classList.add("listItem"),t.appendChild(o),t.appendChild(n),t.id=e.record.id,t.firstChild.innerHTML=i,t.childNodes[1].innerHTML=e.record.name,notionDbBoxSearched.appendChild(t),t.addEventListener("click",(()=>{AddTo.innerHTML=`<span>${e.record.name}</span>`,selectedDB=e.record,chrome.storage.local.set({selectedDB:{type:"collection",id:e.record.collectionId,parentId:e.record.id,name:e.record.name,icon:i}}),document.querySelector("#prototionDialogBox")?dialogBox.classList.remove("search-active"):document.querySelector("#prototionBigDialogBox")&&document.querySelector(".notion-clipper-right").classList.remove("search-active"),searchInput.value="",notionDbBox.classList.remove("hideComplete"),notionPagesBox.classList.remove("hideComplete"),notionDbBoxSearched.classList.add("hideComplete"),notionPagesBoxSearched.classList.add("hideComplete")}))}else if("page"===e.record.type){var o,i;t=document.createElement("div"),n=(o=document.createElement("span")).cloneNode(!0);i=e.record.iconEmoji?e.record.iconEmoji:"✨",t.classList.add("listItem"),t.appendChild(o),t.appendChild(n),t.id=e.record.id,t.firstChild.innerHTML=i,t.childNodes[1].innerHTML=e.record.name,notionPagesBoxSearched.appendChild(t),t.addEventListener("click",(()=>{AddTo.innerHTML=`<span>${e.record.name}</span>`,selectedDB=e.record,chrome.storage.local.set({selectedDB:{type:"block",id:e.record.id,parentId:e.record.id,name:e.record.name,icon:i}}),document.querySelector("#prototionDialogBox")?dialogBox.classList.remove("search-active"):document.querySelector("#prototionBigDialogBox")&&document.querySelector(".notion-clipper-right").classList.remove("search-active"),searchInput.value="",notionDbBox.classList.remove("hideComplete"),notionPagesBox.classList.remove("hideComplete"),notionDbBoxSearched.classList.add("hideComplete"),notionPagesBoxSearched.classList.add("hideComplete")}))}}))}))}),500);searchInput.addEventListener("input",e),notionDbBoxSearched.classList.add("hideComplete"),notionPagesBoxSearched.classList.add("hideComplete"),backButton.classList.add("backButton"),backButton.innerHTML="&#171;&nbsp;&nbsp;Go Back",searchInput.classList.add("notion-clipper-search-input"),searchInput.setAttribute("placeholder","Search for pages..."),notionDataBox.classList.add("notionDataBox"),notionDbBox.classList.add("notionDbBox"),notionPagesBox.classList.add("notionPagesBox"),notionDbBoxSearched.classList.add("notionDbBoxSearched"),notionPagesBoxSearched.classList.add("notionPagesBoxSearched"),saveScreenshotSnippetButton.classList.add("notion-clipper-button-primary"),saveScreenshotSnippetButton.innerHTML="Save",saveScreenshotSnippetButton.style.pointerEvents="auto",cancelButton.classList.add("notion-clipper-button-secondary"),cancelButton.innerHTML="Cancel",backdrop.setAttribute("class","prototionBackdropWrapper"),LargedialogBox.appendChild(LeftBox),LargedialogBox.appendChild(RightBox),backdrop.appendChild(LargedialogBox),document.querySelector("body").appendChild(backdrop)}function saveSnippetImage(e,t){if(!document.body.getAttribute("prototion-web-clipper")){document.body.setAttribute("prototion-web-clipper",!0);const e=pageTitleInput.value,n=window.location.href;if(e&&n){AddTo.innerHTML=`<span>${selectedDB.name}</span>`;const o="https://res.cloudinary.com/skynox-tech/image/upload/v1631102330/Notion%20Pro%20Clipper/static/success_mcyvc3.gif";LargedialogBox.innerHTML=`\n          <div class="lottie-container">\n          <div class="lottie-imageContainer">\n          <img src=${o}></img>\n          </div>\n            <p>Image Saved To Notion<p>\n          </div>\n        `,chrome.runtime.sendMessage({message:"save-image-request",payload:{title:e,url:n,imageSrc:t}},(e=>{if("save_image_success"===e.message)cancelScreenshotSnippet(),document.body.removeAttribute("prototion-web-clipper");else if("save_image_failure"===e.message){const e="https://res.cloudinary.com/skynox-tech/image/upload/v1631102409/Notion%20Pro%20Clipper/static/error_azjn51.gif";LargedialogBox.innerHTML=`\n            <div class="lottie-container">\n            <div class="lottie-imageContainer">\n            <img src=${e}></img>\n            </div>\n              <p>Oops! Something Went Wrong. Please report this issue, We will get it fixed as soon as possible.<p>\n              <div class="notion-pro-clipper-error-container">\n              <div class="notion-pro-clipper-report notion-clipper-button-primary-report">Report</div>\n              <div class="ignore-btn-notion-pro-clipper notion-clipper-button-secondary-ignore">Ignore</div>\n              </div>\n            </div>\n          `,document.querySelector(".notion-pro-clipper-report").addEventListener("click",(()=>{cancelScreenshotSnippet(),window.open("https://forms.clickup.com/f/1rz92-8524/INOKPBNXCK5O3NE46S","_blank")})),document.querySelector(".ignore-btn-notion-pro-clipper").addEventListener("click",(()=>{cancelScreenshotSnippet(),document.body.removeAttribute("prototion-web-clipper")}))}}))}}}function cancelScreenshotSnippet(e){LargedialogBox.innerHTML="",LargedialogBox.remove(),saveScreenshotSnippetButton.remove(),document.querySelector(".lottie-container")&&document.querySelector(".lottie-container").remove(),document.querySelector(".prototionBackdropWrapper")&&document.querySelector(".prototionBackdropWrapper").remove()}function renderSnippetDialog(e,t){makingScreenshotSnippetModal(),heading.innerText=e.heading,pageTitleInput.value=e.pageTitle,LeftBox.innerHTML="",LeftBox.appendChild(t),RightBox.appendChild(heading),RightBox.appendChild(divider),RightBox.appendChild(pageTitleHeading),RightBox.appendChild(pageTitleInput),RightBox.appendChild(AddToHeading),RightBox.appendChild(AddTo),RightBox.appendChild(backButton),RightBox.appendChild(pageDataBaseHeading),RightBox.appendChild(searchInput),RightBox.appendChild(notionDataBox),notionDataBox.appendChild(notionDbBox),notionDataBox.appendChild(notionPagesBox),notionDataBox.appendChild(notionDbBoxSearched),notionDataBox.appendChild(notionPagesBoxSearched),RightBox.appendChild(saveScreenshotSnippetButton),RightBox.appendChild(cancelButton),void 0!==typeof window&&window.scroll(0,0),cancelButton.addEventListener("click",cancelScreenshotSnippet),saveScreenshotSnippetButton.addEventListener("click",(()=>{saveScreenshotSnippetButton.innerHTML=getSpinnerHTML(),saveScreenshotSnippetButton.style.pointerEvents="none",saveSnippetImage(e,t.getAttribute("src"))}))}function getSpinnerHTML(){return'\n  <div class="sk-fading-circle">\n  <div class="sk-circle1 sk-circle"></div>\n  <div class="sk-circle2 sk-circle"></div>\n  <div class="sk-circle3 sk-circle"></div>\n  <div class="sk-circle4 sk-circle"></div>\n  <div class="sk-circle5 sk-circle"></div>\n  <div class="sk-circle6 sk-circle"></div>\n  <div class="sk-circle7 sk-circle"></div>\n  <div class="sk-circle8 sk-circle"></div>\n  <div class="sk-circle9 sk-circle"></div>\n  <div class="sk-circle10 sk-circle"></div>\n  <div class="sk-circle11 sk-circle"></div>\n  <div class="sk-circle12 sk-circle"></div>\n</div>\n  '}chrome.runtime.onMessage.addListener((function(e,t,n){if("snip"===e.message){function o(t){document.removeEventListener("mousedown",c,!1),document.body.style.cursor="default",chrome.runtime.sendMessage({type:"coords"},(function(n){!function(e,t,n){const o=document.createElement("img");o.onload=function(){var e=window&&window.devicePixelRatio,i=t.y*e,a=t.x*e,d=t.w*e,c=t.h*e,r=t.w,s=t.h,l=document.createElement("canvas");l.width=r,l.height=s,l.getContext("2d").drawImage(o,a,i,d,c,0,0,r,s),n({dataUri:l.toDataURL()})},o.src=e}(n.imgSrc,t,(function(t){const n=document.createElement("img");n.setAttribute("src",t.dataUri),renderSnippetDialog(e.payload.data,n)}))}))}var i,a,d;function c(e){return e.preventDefault(),a={x:e.pageX,y:e.pageY},d=e.y,(i=document.createElement("div")).style.background="#222",i.style.opacity="0.1",i.style.position="absolute",i.style.left=e.pageX+"px",i.style.top=e.pageY+"px",i.style.width="0px",i.style.height="0px",i.style.zIndex="1000000",document.body.appendChild(i),document.addEventListener("mousemove",r,!1),document.addEventListener("mouseup",s,!1),!1}function r(e){e.preventDefault();var t=e.pageX,n=e.pageY,o=t-a.x,d=n-a.y;return i.style.width=o+"px",i.style.height=d+"px",!1}function s(e){e.preventDefault();var t=e.pageX,n=e.pageY,c={x:t-a.x,y:n-a.y};return document.removeEventListener("mousemove",r,!1),document.removeEventListener("mouseup",s,!1),i.parentNode.removeChild(i),setTimeout((function(){var e={w:c.x,h:c.y,x:a.x,y:d};e,o(e)}),50),!1}document.body.style.cursor="crosshair",document.addEventListener("mousedown",c,!1)}return!0}));