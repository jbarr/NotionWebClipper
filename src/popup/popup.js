const state={title:"",url:"",tabID:0},userAccountSettingEl=document.querySelector(".account-settings"),userNameEl=document.querySelector(".user-name"),userEmailEl=document.querySelector(".user-email"),userNameNotionEl=document.querySelector(".user-name-notion"),saveUrlButton=document.getElementById("save-url"),saveFullPageMDButton=document.getElementById("fullpage-md"),saveSectionMDButton=document.getElementById("section-md"),saveSnipButton=document.getElementById("snippet"),saveFullButton=document.getElementById("fullpage"),saveVisibleButton=document.getElementById("visible-part"),authSection=document.getElementById("auth"),mainSection=document.getElementById("main-section"),profileSection=document.getElementById("account-section"),toggleSaveImage=document.querySelector(".switch"),showProfile=document.getElementById("userProfile"),notionClipper=document.getElementById("Clipper-notion"),profileBack=document.querySelector(".profileBack"),userHelp=document.querySelector("#userHelp");function showLoggedInProfile(){showProfile.addEventListener("click",(function(){chrome.storage.local.get(["userId","userEmail","userName","userImage"],(e=>{if(e.userId)if(userAccountSettingEl.innerHTML="",mainSection.style.display="none",profileSection.style.display="block",userNameEl.innerText=e.userName,userEmailEl.innerText=e.userEmail,userNameNotionEl.innerText=e.userName,e.userImage){const t=document.createElement("img");t.src=e.userImage,t.classList.add("userImage"),userAccountSettingEl.prepend(t)}else{const t=e.userName[0],o=e.userName.split(" ")[1][0],n=document.createElement("div");n.classList.add("userInitials"),n.innerHTML=`<span>${t}</span><span>${o}</span>`,userAccountSettingEl.prepend(n)}}))}))}function prototionLogoutHandler(){chrome.cookies.getAll({url:"https://www.notion.so/"},(function(e){e.reduce(((e,t)=>({...e,[t.name]:t.value})),{}).token_v2?(chrome.tabs.create({active:!0,url:"https://prototion.com/notion-pro-clipper/login?notion=true&logout=true"}),window.close()):(chrome.tabs.create({active:!0,url:"https://prototion.com/notion-pro-clipper/login?notion=false&logout=true"}),window.close())}))}function openIndex(){chrome.cookies.getAll({url:"https://www.notion.so/"},(function(e){e.reduce(((e,t)=>({...e,[t.name]:t.value})),{}).token_v2?chrome.tabs.create({active:!0,url:"https://prototion.com/notion-pro-clipper/login?notion=true"}):chrome.tabs.create({active:!0,url:"https://prototion.com/notion-pro-clipper/login?notion=false"})}))}function openUrlModal(){void 0!==typeof window&&window.close(),chrome.tabs.sendMessage(state.tabID,{message:"saveUrl",payload:{data:{heading:"Save Url",subheading:"Link preview",url:state.url,pageTitle:state.title}}})}function openFullPageMDModal(){void 0!==typeof window&&window.close(),chrome.tabs.sendMessage(state.tabID,{message:"fullPageMd",payload:{data:{heading:"Save page",subheading:"Image preview",pageTitle:state.title,url:state.url}}})}function openSectionMDModal(){void 0!==typeof window&&window.close(),chrome.tabs.sendMessage(state.tabID,{message:"section",payload:{data:{heading:"Save custom sections",pageTitle:state.title}}})}function openSnipModal(){void 0!==typeof window&&window.close(),chrome.tabs.sendMessage(state.tabID,{message:"snip",payload:{data:{heading:"Save screenshot",subheading:"Save screenshot",pageTitle:state.title}}})}function openFullModal(){void 0!==typeof window&&window.close(),chrome.tabs.sendMessage(state.tabID,{message:"fullpage",payload:{data:{heading:"Save screenshot",subheading:"Save screenshot",pageTitle:state.title}}})}function openVisibleModal(){void 0!==typeof window&&window.close(),chrome.tabs.sendMessage(state.tabID,{message:"visible",payload:{data:{heading:"Save screenshot",subheading:"Save screenshot",pageTitle:state.title}}})}function getCookiesFromNotion(){chrome.cookies.getAll({domain:"www.prototion.com"},(function(e){e.reduce(((e,t)=>({...e,[t.name]:t.value})),{}).user&&chrome.cookies.getAll({url:"https://www.notion.so/"},(function(e){const t=e.reduce(((e,t)=>({...e,[t.name]:t.value})),{});t.token_v2?(authSection.style.display="none",mainSection.style.display="block",showProfile.style.display="inline-block",showLoggedInProfile(),chrome.runtime.sendMessage({message:"load_user",payload:t})):chrome.storage.local.set({selectedDB:null})}))}))}userHelp.addEventListener("click",(()=>{chrome.tabs.create({active:!0,url:"https://forms.clickup.com/f/1rz92-8524/INOKPBNXCK5O3NE46S"}),window.close()})),notionClipper.addEventListener("click",(function(){chrome.storage.local.get("userId",(e=>{e.userId&&(mainSection.style.display="block",profileSection.style.display="none")}))})),profileBack.addEventListener("click",(function(){chrome.storage.local.get("userId",(e=>{e.userId&&(mainSection.style.display="block",profileSection.style.display="none")}))})),chrome.storage.local.get("toggleSaveImage",(e=>{e.toggleSaveImage?(toggleSaveImage.setAttribute("checked",!0),chrome.tabs.sendMessage(state.tabID,{message:"showButtonOnHover"})):(toggleSaveImage.removeAttribute("checked"),chrome.tabs.sendMessage(state.tabID,{message:"removeButtonOnHover"}))})),toggleSaveImage.addEventListener("change",(function(){this.checked?(chrome.storage.local.set({toggleSaveImage:!0}),chrome.tabs.sendMessage(state.tabID,{message:"showButtonOnHover"})):(chrome.storage.local.set({toggleSaveImage:!1}),chrome.tabs.sendMessage(state.tabID,{message:"removeButtonOnHover"}))})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector(".auth-button"),t=document.querySelector("#prototion-logout-btn"),o=document.querySelector("#notion-logout-btn");e.addEventListener("click",openIndex),t.addEventListener("click",prototionLogoutHandler),o.addEventListener("click",(()=>{chrome.tabs.create({active:!0,url:"https://www.notion.so/"}),window.close()}))})),saveUrlButton.addEventListener("click",openUrlModal),saveFullPageMDButton.addEventListener("click",openFullPageMDModal),saveSectionMDButton.addEventListener("click",openSectionMDModal),saveSnipButton.addEventListener("click",openSnipModal),saveFullButton.addEventListener("click",openFullModal),saveVisibleButton.addEventListener("click",openVisibleModal),getCookiesFromNotion();const queryInfo={active:!0,currentWindow:!0};chrome.tabs.query(queryInfo,(function(e){const t=e[0];state.title=t.title,state.url=t.url,state.tabID=t.id}));