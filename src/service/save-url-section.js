const generateUuid=require("@web-clipper/shared/lib/uuid").generateUuid;function getOperations(e,t,a,o,n){let i;return i="block"===e?[{id:t,table:"block",path:[],command:"set",args:{type:"page",id:t,version:1}},{id:t,table:"block",path:[],command:"update",args:{parent_id:a,parent_table:"block",alive:!0}},{table:"block",id:a,path:["content"],command:"listAfter",args:{id:t}},{id:t,table:"block",path:[],command:"update",args:{created_by:o,created_time:2,last_edited_time:2,last_edited_by:o}},{id:a,table:"block",path:[],command:"update",args:{last_edited_time:2}},{id:t,table:"block",path:["properties","title"],command:"set",args:[[`## Link\n\n [${n}](${n})`]]},{id:t,table:"block",path:[],command:"update",args:{last_edited_time:2}}]:[{id:t,table:"block",path:[],command:"set",args:{type:"page",id:t,version:1}},{id:t,table:"block",path:[],command:"update",args:{parent_id:a,parent_table:"collection",alive:!0}}],i}const saveUrlPlusSection=async(e,t)=>{try{const a=generateUuid(),o=t.parentId,n=t.userId,i=t.type,s=t.url,d=t.name,p=t.content,r=getOperations(i,a,o,n,s);await fetch("https://www.notion.so/api/v3/submitTransaction",{method:"POST",headers:{Cookie:e,"Content-Type":"application/json"},body:JSON.stringify({operations:r})});const c={bucket:"temporary",contentType:"text/markdown",name:`${d}.md`},l=await fetch("https://www.notion.so/api/v3/getUploadFileUrl",{method:"POST",headers:{"Content-Type":"application/json",Cookie:e},body:JSON.stringify(c)}),m=await l.json(),b=await fetch("https://prototion.com/api/notion-web-clipper",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:p})}),{data:u}=await b.json();await fetch(m.signedPutUrl,{method:"PUT",headers:{"Content-Type":"text/markdown"},body:u});const h={task:{eventName:"importFile",request:{fileName:`${d}.md`,fileURL:m.url,importType:"ReplaceBlock",pageId:a}}};return await fetch("https://www.notion.so/api/v3/enqueueTask",{method:"POST",headers:{Cookie:e,"Content-Type":"application/json"},body:JSON.stringify(h)}),{success:!0,message:"Content uploaded successfully"}}catch(e){return{success:!1,message:e.message}}};module.exports=saveUrlPlusSection;